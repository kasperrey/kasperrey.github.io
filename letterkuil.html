<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Letterkuil</title>
</head>
<body>
<script src="./alles_met_localstorage.js"></script>

<button onclick="window.location.assign('configureer.html')" style="font: 30px Arial; position: absolute; top: 300px; left: 1000px">speel spel</button>
<button onclick="createSpeler()" style="position: absolute; top: 650px; left: 680px">maak speler</button>
<input style="position: absolute; top: 650px; left: 500px" id="input" placeholder="nieuwe speler naam">
<h1 style="font: 70px Arial; position: absolute; top: 80px; left: 500px">L   e   t   t   e   r   k   u   i   l</h1>

<script>
    var personen = []
    var lijst_personen = window.alles_met_localstorage.getLijst_met_personen()
    window.alles_met_localstorage.check()
    for (var persoon of lijst_personen) {
        if (persoon.includes("letterkuil-speler-")) {
            personen.push(window.alles_met_localstorage.getPersoon(persoon))
        } else {
            window.alles_met_localstorage.remove(persoon)
            lijst_personen.splice(lijst_personen.indexOf(persoon), 1)
        }
    }
    window.alles_met_localstorage.setGeselecteerd_persoon({})
    window.alles_met_localstorage.setGeselecteerde_letters([])

    var beginDingen = []
    var geselcteerdeSpeler = null
    var button;
    beginscherm()

    function beginscherm() {
        var y = 200
        for (persoon of lijst_personen) {
            button = document.createElement("button");
            var deleteButton = document.createElement("button")
            button.style.font = "30px Arial"
            button.style.position = "absolute"
            button.style.left = "500px"
            button.style.top = y.toString()+"px"
            button.style.width = "240px"
            button.innerText = persoon.replace("letterkuil-speler-", "")
            button.persoon = persoon
            if (lijst_personen.length > 1) {
                button.style.background = "#868686"
            } else {
                button.style.background = "#0d8600"
                geselcteerdeSpeler = button
                window.alles_met_localstorage.setGeselecteerd_persoon(personen.at(lijst_personen.indexOf(persoon)))
            }
            button.onclick = function (ev) {
                if (geselcteerdeSpeler) {
                    geselcteerdeSpeler.style.background = "#868686"
                }
                ev.currentTarget.style.background = "#0d8600"
                geselcteerdeSpeler = ev.currentTarget
                window.alles_met_localstorage.setGeselecteerd_persoon(personen.at(lijst_personen.indexOf(ev.currentTarget.persoon)))
            }
            deleteButton.delete = persoon
            deleteButton.style.position = "absolute";
            deleteButton.style.left = (500+parseInt(button.style.width.replace("px", ""))).toString()+"px"
            deleteButton.style.top = y.toString()+"px"
            deleteButton.innerHTML = '<img src="vuilbak.jpg" alt="delete"/>';
            deleteButton.onclick = deleteSpeler
            beginDingen.push(button)
            beginDingen.push(deleteButton)
            document.body.appendChild(button)
            document.body.appendChild(deleteButton)
            y+=35
        }
    }

    function deleteSpeler(ev) {
        lijst_personen.splice(lijst_personen.indexOf(ev.currentTarget.delete), 1)
        window.alles_met_localstorage.remove(ev.currentTarget.delete)
        window.alles_met_localstorage.setLijst_met_personen(lijst_personen)
        for (var b of beginDingen) {
            b.remove()
        }
        beginDingen = []
        beginscherm()
    }

    function createSpeler() {
        var input = document.getElementById("input")
        lijst_personen.push("letterkuil-speler-"+input.value)
        var speler = {
            "naam": "letterkuil-speler-"+input.value,
            "level": 1,
            "diamanten": 0,
            "hoed": "hogehoed.png",
            "monster": "pacman",
            "kleur": "geel",
            "muziek": null
        }
        personen.push(speler)
        window.alles_met_localstorage.setPersoon("letterkuil-speler-"+input.value, speler)
        window.alles_met_localstorage.setLijst_met_personen(lijst_personen)
        for (var b of beginDingen) {
            b.remove()
        }
        beginDingen = []
        beginscherm()
    }
</script>
</body>
</html>
