<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Letterkuil</title>
</head>
<body>
<script>
    var lijst_personen = []
    var personen = []
    var self = new Map()

    var lijstKey = "letterkuil-lijst_personen"
    var selfKey = "letterkuil-geselekteerd_persoon"
    localStorage.removeItem("letterkuil-lijst_records")
    localStorage.removeItem("letterkuil-lijst_diamanten")
    if (!localStorage.getItem(lijstKey)) {
        localStorage.setItem(lijstKey, JSON.stringify(lijst_personen))
    }
    lijst_personen = JSON.parse(localStorage.getItem(lijstKey))
    for (var persoon of lijst_personen) {
        personen.push(JSON.parse(localStorage.getItem(persoon)))
    }
    localStorage.setItem(selfKey, JSON.stringify(Array.from(self.entries())))
    localStorage.setItem("letterkuil-geselecteerde_letters", JSON.stringify([]))

    var canvas = document.createElement('canvas');
    canvas.width = 1500;
    canvas.height = 700;
    document.body.appendChild(canvas);
    var c = canvas.getContext('2d');
    var beginDingen = []
    var geselcteerdeSpeler = null
    var button;
    beginscherm()

    function beginscherm() {
        var y = 200
        c.font = "70px Arial"
        c.fillText("L   e   t   t   e   r   k   u   i   l", 500, 80)
        var input = document.createElement("input")
        var maakSpeler = document.createElement("button")
        var speel = document.createElement("button")
        input.value = "nieuwe speler naam"
        input.style.position = "absolute"
        input.style.left = "500px"
        input.style.top = "650px"
        maakSpeler.innerText = "maak speler"
        maakSpeler.style.position = "absolute"
        maakSpeler.style.left = "680px"
        maakSpeler.style.top = "650px"
        maakSpeler.inputveld = input
        maakSpeler.onclick = createSpeler
        speel.innerText = "speel spel"
        speel.style.font = "30px Arial"
        speel.style.position = "absolute"
        speel.style.left = "1000px"
        speel.style.top = "300px"
        speel.onclick = function () {
            window.location.assign("configureer.html")
        }
        beginDingen.push(input)
        beginDingen.push(maakSpeler)
        beginDingen.push(speel)
        document.body.appendChild(input)
        document.body.appendChild(maakSpeler)
        document.body.appendChild(speel)
        for (persoon of lijst_personen) {
            button = document.createElement("button");
            var deleteButton = document.createElement("button")
            button.style.font = "30px Arial"
            button.style.position = "absolute"
            button.style.left = "500px"
            button.style.top = y.toString()+"px"
            button.style.width = "240px"
            button.innerText = persoon.replace("letterkuil-", "")
            button.persoon = persoon
            if (lijst_personen.length > 1) {
                button.style.background = "#868686"
            } else {
                button.style.background = "#0d8600"
                geselcteerdeSpeler = button
                self = new Map()
                self.set(persoon, personen.at(lijst_personen.indexOf(persoon)))
                localStorage.setItem(selfKey, JSON.stringify(Array.from(self.entries())))
            }
            button.onclick = function (ev) {
                ev.currentTarget.style.background = "#0d8600"
                if (geselcteerdeSpeler) {
                    geselcteerdeSpeler.style.background = "#868686"
                }
                geselcteerdeSpeler = ev.currentTarget
                self = new Map()
                self.set(ev.currentTarget.persoon, personen.at(lijst_personen.indexOf(ev.currentTarget.persoon)))
                localStorage.setItem(selfKey, JSON.stringify(Array.from(self.entries())))
            }
            deleteButton.delete = persoon
            deleteButton.style.position = "absolute";
            deleteButton.style.left = (500+parseInt(button.style.width.replace("px", ""))).toString()+"px"
            deleteButton.style.top = y.toString()+"px"
            deleteButton.innerHTML = '<img src="vuilbak.jpg" alt="delete"/>';
            deleteButton.onclick = deleteSpeler
            beginDingen.push(button)
            beginDingen.push(deleteButton)
            document.body.appendChild(button)
            document.body.appendChild(deleteButton)
            y+=35
        }
    }

    function deleteSpeler(ev) {
        lijst_personen.splice(lijst_personen.indexOf(ev.currentTarget.delete), 1)
        localStorage.removeItem(ev.currentTarget.delete)
        localStorage.setItem(lijstKey, JSON.stringify(lijst_personen))
        for (var b of beginDingen) {
            b.remove()
        }
        beginDingen = []
        beginscherm()
    }

    function createSpeler(ev) {
        lijst_personen.push("letterkuil-"+ev.currentTarget.inputveld.value)
        localStorage.setItem("letterkuil-"+ev.currentTarget.inputveld.value, JSON.stringify([1, 0]))
        localStorage.setItem(lijstKey, JSON.stringify(lijst_personen))
        for (var b of beginDingen) {
            b.remove()
        }
        beginDingen = []
        beginscherm()
    }
</script>
</body>
</html>
